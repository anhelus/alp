
<!doctype html>
<html lang="it" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.6">
    
    
      
        <title>Lecture - Informatica per l'Ingegneria (classe N)</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.50c56a3b.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-J2XESD8WDV"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-J2XESD8WDV",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-J2XESD8WDV",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#costruttori-di-class-in-python-ed-il-processo-di-istanziamento" class="md-skip">
          Vai al contenuto
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Intestazione">
    <a href="../../../../.." title="Informatica per l&#39;Ingegneria (classe N)" class="md-header__button md-logo" aria-label="Informatica per l'Ingegneria (classe N)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Informatica per l'Ingegneria (classe N)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lecture
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Cerca" placeholder="Cerca" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Cerca">
        
        <button type="reset" class="md-search__icon md-icon" title="Cancella" aria-label="Cancella" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inizializza la ricerca
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigazione" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Informatica per l&#39;Ingegneria (classe N)" class="md-nav__button md-logo" aria-label="Informatica per l'Ingegneria (classe N)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Informatica per l'Ingegneria (classe N)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home del corso
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tracce di esame svolte
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tracce di esame svolte
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../exams/17_01_24/exam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Traccia del 17 gennaio 2024
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Algoritmi di ordinamento
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Algoritmi di ordinamento
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../xx_sorting/01_selection_sort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Selection sort
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Indice">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Indice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#costruttori-di-class-in-python-ed-il-processo-di-istanziamento" class="md-nav__link">
    <span class="md-ellipsis">
      Costruttori di class in Python ed il processo di Istanziamento
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conoscere-i-costruttori-di-classe-di-python" class="md-nav__link">
    <span class="md-ellipsis">
      Conoscere i costruttori di classe di Python
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comprendere-il-processo-di-istanziamento-di-python" class="md-nav__link">
    <span class="md-ellipsis">
      Comprendere il processo di istanziamento di Python
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Comprendere il processo di istanziamento di Python">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inizializazzione-degli-oggetti-con-init" class="md-nav__link">
    <span class="md-ellipsis">
      INizializazzione degli oggetti con init()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fornire-degli-inizializzatori-custom-degli-oggetti" class="md-nav__link">
    <span class="md-ellipsis">
      Fornire degli inizializzatori custom degli oggetti
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#costruire-degli-inizializzatori-flessibili" class="md-nav__link">
    <span class="md-ellipsis">
      Costruire degli inizializzatori flessibili
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creazione-delloggetto-con-new" class="md-nav__link">
    <span class="md-ellipsis">
      Creazione dell'oggetto con new()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fornire-dei-creatori-di-oggetti-custom" class="md-nav__link">
    <span class="md-ellipsis">
      Fornire dei creatori di oggetti custom
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subclassing-dei-tipi-built-in-immutabili" class="md-nav__link">
    <span class="md-ellipsis">
      SUbclassing dei tipi built-in immutabili
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restituire-istanze-di-una-classe-differente" class="md-nav__link">
    <span class="md-ellipsis">
      Restituire istanze di una classe differente
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permettere-solo-una-singola-istanza-nelle-nostre-classi" class="md-nav__link">
    <span class="md-ellipsis">
      PErmettere solo una singola istanza nelle nostre classi
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#emulazione-parziale-di-collectionsnamedtuple" class="md-nav__link">
    <span class="md-ellipsis">
      Emulazione parziale di collections.namedtuple
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusioni" class="md-nav__link">
    <span class="md-ellipsis">
      conclusioni
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Lecture</h1>

<p>La maggior parte dei linguaggi OOP come Java, C++, C# hanno il concetto di un costruttore, un metodo speciale che crei ed inizializzi l'oggetto quando viene creato. Python è un po' differente: ha un costruttore ed un inizializzatore. La funzione costruttore è raramente usata a meno che non stia facendo qualcosa di esotico. Di conseguenza, iniziamo la nostra discussione con il metodo di inizializzazione.</p>
<p>La funzione costruttore in Python è chiamata <strong>new</strong> ed <strong>init</strong> è la funzione di inizializzazione.</p>
<p>Andardo a riprendere la documentazione Python, <strong>new</strong> è usato qunado abbiamo bisogno di controllare la creazione di una nuova istanza mentre <strong>init</strong> è usato quando abbaimo bisogno dell'inizializzazione di una nuova istanza.</p>
<p><strong>new</strong> è il primo step della creazione dell'istanza. E' chiamata per prima ed è responsabile per restituire una nuova istanza della nosttra classe.</p>
<p>In contrasto, <strong>init</strong> non restituisce niente: è responsabile soltanto per inizializzare l'istanza dopo che è stata creata. In generale, non dovremo sovrascrivere il metodo <strong>new</strong>, a meno che non stiamo andando ad usare una subclass per un tipo immutabile come str, int, Unicode o tuple.</p>
<h2 id="costruttori-di-class-in-python-ed-il-processo-di-istanziamento">Costruttori di class in Python ed il processo di Istanziamento<a class="headerlink" href="#costruttori-di-class-in-python-ed-il-processo-di-istanziamento" title="Permanent link">&para;</a></h2>
<p>Come molti altri linguaggi di programmazione, Python supporta la OOP. Al centro delle capacità object-oriented di Python, troveremo la keyword class, che ci permette di definire le classi custom che possono avere degli attributi per memorizzare i dati ed i metodi per fornire dei comportamenti.</p>
<p>Una volta avuta una classe con cui lavorare, a questo punto possiamo iniziare a creare nuove istanze o ogetti della classe, che è un modo efficiente per riutilizzare le funzionalità nel nostro codice.</p>
<p>Creare ed inizializzare gli oggetti di una data classe sono uno step fondamentale nella OOP. Questo passo è spesso riferito come costruzione o istanziamento degli oggetti. I tool responsabile per creare questo processo di istanziamento è spesso conosciuto come costruttore di classe.</p>
<h2 id="conoscere-i-costruttori-di-classe-di-python">Conoscere i costruttori di classe di Python<a class="headerlink" href="#conoscere-i-costruttori-di-classe-di-python" title="Permanent link">&para;</a></h2>
<p>In Python, per costruire un oggetto di una data classe, dobbiamo soltanto chiamare la classe con degli argomenti appropriati, così come chiameremmo una qualsiasi funzione:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">SomeClass</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="n">SomeClass</span><span class="p">()</span>
<span class="c1">#FAR VEDRE LA CALSSE</span>
</code></pre></div>
<p>In questo esempio, definiamo SomeClass usando la parola chiave class. QUesta classe è al momento vuota perché non ha attributi o metodi. Invece, il corpo della classe contiene soltanto un'istruzione pass come istruzione "placeholder" che non fa niente.</p>
<p>Quindi creiamo una nuova istanza di SomeClass chiamando la clase con una coppia di paretnesi. In questo esempio, non dobbiamo passare alcun argomento nella chiamata perché la nostra classe non prende ancora alcun argomento.</p>
<p>In Python, quando chiamiamo una classe come fatto nell'esempio prcecente, stiamo chiamando il costruttore di classe, che crea, inizializza e restituisce un nuovo oggetto lanciando il processo interno di istanziamento di Python.</p>
<p>Un ultimo punto da notare è che chiamare una classe non è lo stesso di chiamare un'<em>istanza</em> di una classe. Questi sono due topic differenti e completamente incorrelati. Per rendere chiamabile l'istanza di una classe, dobbiamo implementare un metodo speciale __call(), che non ha niente a che fare con il processo di istanziamento di Python.</p>
<h2 id="comprendere-il-processo-di-istanziamento-di-python">Comprendere il processo di istanziamento di Python<a class="headerlink" href="#comprendere-il-processo-di-istanziamento-di-python" title="Permanent link">&para;</a></h2>
<p>Lanciamo il processo di istanziamento di PYthon quando chiamiamo una classe Python per creare una nuova istanza. Questo processo viene eseguito in due step separati, che possiamo descrivere come segue:</p>
<ul>
<li>creazione di una nuova istanza della classe target</li>
<li>inizializzazione della nuova istanza con uno stato iniziale appropriato</li>
</ul>
<p>Per eseguire il primo step, le classi Python hanno un metodo speciale chiamato <strong>new</strong>(), che è responsabile per la creazione e la restituzione di un nuovo oggetto vuoto. A questo punto un nuovo metodo speciale, <strong>init</strong>(), prende l'oggetto risultante, assieme agli argomenti del costruttore di classe.</p>
<p>Il metodo <strong>init</strong> prende il nuovo oggetto come suo primo argometno, <code>self</code>. Quindi imposta ogni attributo dell'istanza richiesto ad uno stato valido usando gli argomenti che gli ha passato il costruttore di classe.</p>
<p>In breve, il processo di istanziamento di Python inizia con una chiamata al costruttore di classe, che lancia il creatore dell'istanza, <strong>new</strong>(), facendogli creare un nuovo oggetot vuoto. Il processo continua con l'inizializzatore dell'istanza, <strong>inti</strong>(), che prende gli argometni del crostruttore per inizializzare l'oggetto appena creato.</p>
<p>Per esploare il processo di istanziamento di Python internamente, possiamoc consdierare il seguente esempio di una classe Punto che implementa una versione custom di entrambi i metodi.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Punto</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Creazione di una nuova istanza di Punto.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. Inizializzazione di una nuova istanza di Punto.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(x=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="si">}</span><span class="s2">, y=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
<p>Questo codice:</p>
<ul>
<li>alla riga 3, definisce la classe Punto usando la parola chiave <code>class</code> seguita dal nome della classe.</li>
<li>alla riga 4, definisce il metodo <strong>new</strong>(), che prende la classe come primo argomento. Notiamo che il primo argomento è <code>cls</code>. Il metodo prende inoltre <code>*args</code> e <code>**kwargs</code>, che permettono di passare un numero indefinito di argomenti di inizializzazione all'istanza sottostante.</li>
<li>alla riga 5, scriviamo un messaggio quando <strong>new</strong>() esegue lo step di creazione</li>
<li>alla rgia 6, creiamo una nuova istanza di Punto chiamando il metodo <strong>new</strong>() della classe padre con cls come argomento. In questo esempio, la class padre è <code>object</code>, e la chiamata a super() vi dà accesso. Quindi, l'istanza viene restituita. Questa istanza sarà il primo argometno ad <strong>init</strong>.</li>
<li>alla riga 8 definisce <strong>init</strong>(), che si occupa dello step di inizializzazione. Questo metodo prende un primo argomento (self), che ha un riferimento all'instanza atutale. Il metodo prende anche due ulteriori argomenti, x ed y. QUesti argomenti hanno i valori iniziali per gli attributi dell'istanza x ed y. Dobbiamo passare dei valori adatti per questi argomenti nella chiamata a Punto(), come vedremo a breve.</li>
<li>la riga 9 scrive un messaggio quando <strong>init</strong>() esegue lo step di inizializzazione dell'oggetto</li>
<li>le righe 10 ed 11 inizializzano x ed y, rispettivamente. Per farlo, usano gli argomenti di input forniti (x ed y)</li>
<li>le righe 13 e 14 implementano il metodo speciale <strong>repr</strong>, che fornisce una rappresentazione aduegata sotto forma di stringa degli oggetti di classe Point.</li>
</ul>
<p>Possiamo adesso scoprire come funziona il processo di istanziamento nella pratica. Salviamo il nostro codice in un file chiamato putno.py e lanciamo il nostro itnerprete Python in una finestra a riga di comando. Quindi eseguiamo il seguente codice:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">point</span> <span class="kn">import</span> <span class="n">Point</span>

<span class="n">point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>

<span class="mf">1.</span> <span class="n">Create</span> <span class="n">a</span> <span class="n">new</span> <span class="n">instance</span> <span class="n">of</span> <span class="n">Point</span><span class="o">.</span>
<span class="mf">2.</span> <span class="n">Initialize</span> <span class="n">the</span> <span class="n">new</span> <span class="n">instance</span> <span class="n">of</span> <span class="n">Point</span><span class="o">.</span>
</code></pre></div>
<p>Chiamare il costruttore di classe Point() crea, inizializza e restituisce una nuova istanza della classe. Questa istanza è quindi assegnata alla variabile point.</p>
<p>In questo esempio, la chiamata al costruttore ci permette anche di conoscere gli step che Python esegue internamente per costruire l'istanza. In primis, Python chiama <code>__new__()</code>, e quindi <code>__init__()</code>, il che risulta in una nuova e completamente inizializzata istanza di <code>Punto</code>, come possiamo vedere al termine dell'esempio.</p>
<p>Possiamo anche provare ad eseguire entrambi gli step manualmente:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">point</span> <span class="kn">import</span> <span class="n">Point</span>

<span class="n">point</span> <span class="o">=</span> <span class="n">Point</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">Point</span><span class="p">)</span>
<span class="mf">1.</span> <span class="n">Create</span> <span class="n">a</span> <span class="n">new</span> <span class="n">instance</span> <span class="n">of</span> <span class="n">Point</span><span class="o">.</span>

<span class="o">&gt;&gt;&gt;</span> <span class="c1"># The point object is not initialized</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">point</span><span class="o">.</span><span class="n">x</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
    <span class="o">...</span>
<span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;x&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">point</span><span class="o">.</span><span class="n">y</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
    <span class="o">...</span>
<span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;y&#39;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">point</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
<span class="mf">2.</span> <span class="n">Initialize</span> <span class="n">the</span> <span class="n">new</span> <span class="n">instance</span> <span class="n">of</span> <span class="n">Point</span><span class="o">.</span>

<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Now point is properly initialized</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">point</span>
<span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</code></pre></div>
<p>In questo esempio, per prima cosa chiamiamo <code>__new__()</code> sulla classe Punto, passando la classe stessa come primoa rgomento al meotod. Questa chiamata viene solo eseguita come primo step del processo di istanziamento, creando un nuovo oggetto vuoto. Notiamo che creare un'istanza in questo modo bypassa la chiamata ad <code>__init__()</code>.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>L'esempio precedente deve essere inteso come un esempio dimostrativo di come funziona il processo di istanziamento itnernamente. Non è un qualcosa che vogliamo tipicamente fare nel codice reale.</p>
</div>
<p>Una volta che abbiamo il nuovo oggetto, possiamo inizializzarlo chiamando <code>__init__()</code> con un insieme appropriato di argomenti. Dopo questa chiamata, il nostro oggetto Punto è inizializzato, con tutti i suoi attributi impostati.</p>
<p>Un sottile, ma importante, dettaglio da notare su <code>__new__()</code> è che può anche restituire un'istanza di una classe differente dalla classe che implementa il metodo stesso. Quando questo accade, Python non chiama <code>__init__()</code> nella classe attuale, perché non c'è modo di sapere in maniera non ambigua come inizializzare un oggetto di una classe differente.</p>
<p>Consideriamo il seguente esempio, nel quale il metodo <strong>new</strong>() della classe B restituisce un'istanza della classe A:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ab_classes.py</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_value</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initialize the new instance of A.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_value</span> <span class="o">=</span> <span class="n">a_value</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">A</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b_value</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initialize the new instance of B.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b_value</span> <span class="o">=</span> <span class="n">b_value</span>
</code></pre></div>
<p>Siccome <code>B.__new__()</code> restituisce un'istanza di una clase differente, Python non esegue B.<strong>init</strong>(). Per confermare questo comportamento, salviamo il codice in un file chiamato classi_ab.py e quindi eseguiamo il codice seguente in una sessione Python interattiva.</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">ab_classes</span> <span class="kn">import</span> <span class="n">B</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">B</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span>
<span class="n">Initialize</span> <span class="n">the</span> <span class="n">new</span> <span class="n">instance</span> <span class="n">of</span> <span class="n">A</span><span class="o">.</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="o">.</span><span class="n">b_value</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
    <span class="o">...</span>
<span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;b_value&#39;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
<span class="kc">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
<span class="kc">True</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="o">.</span><span class="n">a_value</span>
<span class="mi">42</span>
</code></pre></div>
<p>La chiamata al costruttore della classe <code>B()</code> esegue <code>B.__new__()</code>, che restituisce un'istanza di A invece di B. Per questo motivo, <code>B.__ini__()</code> non viene mai eseguito. Notiamo che b non ha un attributo b<em>value. In contrasto, b ha un attributo a</em>value, con valore 42.</p>
<p>Ora che conosciamo gli step che Python percorre internamente per creare istanze di una data classe, possiamo scendere più nel dettaglio nelle altre caratteristiche di <strong>init</strong>(), <strong>new</strong>() e gli step che eseguono.</p>
<h3 id="inizializazzione-degli-oggetti-con-init">INizializazzione degli oggetti con <strong>init</strong>()<a class="headerlink" href="#inizializazzione-degli-oggetti-con-init" title="Permanent link">&para;</a></h3>
<p>In Python, il metodo <strong>init</strong>() è probabilmente il metodo speciale più comemente sovrascritto nelle nostre classi custom. Più o meno tutte le nostre classi avranno bisogno di un'implementazione custom di <strong>init</strong>(). Sovrascrivere questo metodo ci permette di inizializzare propriamente i nostri oggetti.</p>
<p>LO scopo di questo step di inizializzazione è lasciare i nostri nuovi oggetti in uno stato valido, in modo che li si possa iniziare ad usare immediatamente nel nostro codice. In questa sezione, vedremo le basi di scrivere i nostri metodi <strong>init</strong>(), e come ci possono aiutare a customizzare le nostre classi.</p>
<h3 id="fornire-degli-inizializzatori-custom-degli-oggetti">Fornire degli inizializzatori custom degli oggetti<a class="headerlink" href="#fornire-degli-inizializzatori-custom-degli-oggetti" title="Permanent link">&para;</a></h3>
<p>L'implementazione più basilare di <strong>init</strong>() che possiamo scrivere si occuperà soltanto di assegnare gli argomenti in input ai corrispondenti attributi dell'istanza. Ad esempio, diciamo che stiamo scrivendo una classe Rettangolo che richiede gli attributi width ed height. In questo caso, possiamo fare qualcosa come questa:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">Rectangle</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
<span class="o">...</span>         <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
<span class="o">...</span>         <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
<span class="o">...</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">rectangle</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">rectangle</span><span class="o">.</span><span class="n">width</span>
<span class="mi">21</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">rectangle</span><span class="o">.</span><span class="n">height</span>
<span class="mi">42</span>
</code></pre></div>
<p>Come abbiamo visto prima, <strong>init</strong>() esegue il secondo step dell'istanziamento dell'oggetto in Python. Il suo primo argomento, <code>self</code>, contiene la nuova istanza che risulta dalla chiamata a <code>__new__()</code>. Il resto degli argomenti ad <code>__init__()</code> sono normalmente usati per inizializzare gli attributi dell'istanza. Nell'esempio precedente, abbiamo inizializzato le proprietà width ed height del rettangolo usando gli argomenti width ed height passati ad <strong>inti</strong>().</p>
<p>E' importante notare che, senza contare il self, gli argomenti all'<strong>init</strong>() sono gli stessi che passiamo nella chiamata al costruttore di classe. Di conseguenza, possiamo dire che la firma <strong>init</strong>() definisce la firma del costruttore di classe.</p>
<p>Inoltre, teniamo a mente che <strong>inti</strong>() non deve esplciritamente restituire un qualcosa di diverso da None, o otterremo un'eccezione di tipo TypeError.</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">Rectangle</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
<span class="o">...</span>         <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
<span class="o">...</span>         <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
<span class="o">...</span>         <span class="k">return</span> <span class="mi">42</span>
<span class="o">...</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">rectangle</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
    <span class="o">...</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="fm">__init__</span><span class="p">()</span> <span class="n">should</span> <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ow">not</span> <span class="s1">&#39;int&#39;</span>
</code></pre></div>
<p>In questo esempio, il metodo <strong>init</strong>() prova a restituire un numero intero, che finisce per lanciare un'eccezione <code>TypeError</code> a runtime.</p>
<p>Il messaggio di errore nell'esempio precedente ci dice che il metodo <strong>init</strong>() deve restituire None. Ad ogni modo, non dobbiamo aggiungere un return None esplciitamente, perché i metodi e le funzioni senza un'istruzione return esplicita semplicemente restituiscono None, in Python.</p>
<p>Con l'implementazione precedente di <strong>init</strong>(), ci assicuriamo che width ed height vengano inizializzati ad uno stato valido quando chiamiamo il Costruttore di lcasse con argomenti adeguati. In questo modo, i nostri rettangoli saranno pronti all'uso dopo che finisce il processo di costruzione.</p>
<p>In <strong>init</strong>(), possiamo eseguire una qualsiasi trasformazione degli argomenti di input per inizializzare propriamente gli attributi dell'istanza. Ad esempio, se i nostri utenti useranno direttamente un rettangolo, allora potremmo voler validare i valori forniti di width ed height ed assicurarci che siano corretti prima di inizializzare gli attributi corrispondenti:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">Rectangle</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
<span class="o">...</span>         <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="ow">and</span> <span class="n">width</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
<span class="o">...</span>             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;positive width expected, got </span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="o">...</span>         <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
<span class="o">...</span>         <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="ow">and</span> <span class="n">height</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
<span class="o">...</span>             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;positive height expected, got </span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="o">...</span>         <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
<span class="o">...</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">rectangle</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span><span class="o">-</span><span class="mi">21</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
    <span class="o">...</span>
<span class="ne">ValueError</span><span class="p">:</span> <span class="n">positive</span> <span class="n">width</span> <span class="n">expected</span><span class="p">,</span> <span class="n">got</span> <span class="o">-</span><span class="mi">21</span>
</code></pre></div>
<p>In questa implementazione aggiornata di <strong>init</strong>(), ci assicuriamo che gli argomenti di input width ed height siano numeri positivi prima di inizializzare gli attributi width ed height corrispondenti. Se una validazione tra le due fallisce, abbiamo un ValueError.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Una tecnica maggiormente Pythonica prevede dii gestire la validazione degli attributi mediante delle property.</p>
</div>
<p>Ora diciamo ches tiamo usando l'ereditarietà per fcreare una gerarchia di classi custom e riutilizzare delle funzionalità nel nostro codice. Se la nostra sottoclasse fornisce un metodo <strong>init</strong>(), allora questo metodo deve esplicitamente chiamare l'<strong>init</strong>() della classe base con argomenti appropriati per assicurare la corretta inizializzazione delle istanze. Per farlo, dobbiamo suare la funzione built-in super() come nel seguente esempio.</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">birth_date</span><span class="p">):</span>
<span class="o">...</span>         <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
<span class="o">...</span>         <span class="bp">self</span><span class="o">.</span><span class="n">birth_date</span> <span class="o">=</span> <span class="n">birth_date</span>
<span class="o">...</span>

<span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">Person</span><span class="p">):</span>
<span class="o">...</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">birth_date</span><span class="p">,</span> <span class="n">position</span><span class="p">):</span>
<span class="o">...</span>         <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">birth_date</span><span class="p">)</span>
<span class="o">...</span>         <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span>
<span class="o">...</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">john</span> <span class="o">=</span> <span class="n">Employee</span><span class="p">(</span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span> <span class="s2">&quot;2001-02-07&quot;</span><span class="p">,</span> <span class="s2">&quot;Python Developer&quot;</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">john</span><span class="o">.</span><span class="n">name</span>
<span class="s1">&#39;John Doe&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">john</span><span class="o">.</span><span class="n">birth_date</span>
<span class="s1">&#39;2001-02-07&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">john</span><span class="o">.</span><span class="n">position</span>
<span class="s1">&#39;Python Developer&#39;</span>
</code></pre></div>
<p>La prima riga nel metodo <strong>init</strong>() di Impiegato chiama super().<strong>init</strong>() con argomenti nome e data di compleanno. Questa chiamata assicura l'inizializzazione degli attributi name e birth_date nella classe madre, Persona. Questa tecnica ci permette di estendere la classe base con nuovi attributi e funzioanlità.</p>
<p>PEr terminare questa sezione, dovremo sapere che l'implementazione base di <strong>init</strong>() viene dalla classe object. Questa implementazione viene chiamata in automatico quando non forniamo un metodo <strong>init</strong>() esplicito nelle nostre classi.</p>
<h3 id="costruire-degli-inizializzatori-flessibili">Costruire degli inizializzatori flessibili<a class="headerlink" href="#costruire-degli-inizializzatori-flessibili" title="Permanent link">&para;</a></h3>
<p>Possiamo rendere gli step di inizializzazione dei nostri oggetti flessibili e versatili modificando il metodo <strong>init</strong>(). A tal scopo, una delle tecniche più popolari è quella di usare degli argomenti opzionali. Questa tecnica ci permette di scrivere delle classi nelle quali il costruttore accetta diversi insiemi di argomenti di input al momento dell'istanziamento. Quali arogmenti utilizzare ad un dato istante di tempo dipende dai nostri specifici obiettivi e contesto.</p>
<p>Come rapido esempio, vediamo la seguente classe Greeter:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># greet.py</span>

<span class="k">class</span> <span class="nc">Greeter</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">formal</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formal</span> <span class="o">=</span> <span class="n">formal</span>

    <span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formal</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Good morning, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hello, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>
</code></pre></div>
<p>IN questo esempio, <strong>init</strong>() prende un argomento regolare chiamato <code>name</code>. Accetta anche un argomento opzionale chiamato <code>formal</code>, che di default assume il valore <code>False</code>. Dato che <code>formal</code> ha un valore di default, possiamo costruire degli oggetti affidandoci a questo valore o fornirne uno noi.</p>
<p>Il comportamento finale della classe dipenderà dal valore di formal. Se questo argomento è False, allora avremo un greeting informale qunado chiameremo il metodo greet(). Altrimenti, avremo un benvenuto più formale.</p>
<p>Per provare Greeter, salviamo il codice in un file greet.py. Quindi, apriamo una sessione interattiva nella nostra cartella di lavoro, eseguendo questo codice:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">greet</span> <span class="kn">import</span> <span class="n">Greeter</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">informal_greeter</span> <span class="o">=</span> <span class="n">Greeter</span><span class="p">(</span><span class="s2">&quot;Pythonista&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">informal_greeter</span><span class="o">.</span><span class="n">greet</span><span class="p">()</span>
<span class="n">Hello</span><span class="p">,</span> <span class="n">Pythonista</span><span class="err">!</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">formal_greeter</span> <span class="o">=</span> <span class="n">Greeter</span><span class="p">(</span><span class="s2">&quot;Pythonista&quot;</span><span class="p">,</span> <span class="n">formal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">formal_greeter</span><span class="o">.</span><span class="n">greet</span><span class="p">()</span>
<span class="n">Good</span> <span class="n">morning</span><span class="p">,</span> <span class="n">Pythonista</span><span class="err">!</span>
</code></pre></div>
<p>Nel primo esempio, creiamo un oggetto chiamato informal_greeter passando un valore all'argomento name ed affidandoci al valore di default di formal. Otteniamo un messaggio di benvenuto informale sul nostro schermo quando chiamiamo greet() su questo oggetto.</p>
<p>Nel secondo esempio, usiamo un nome ed un argomento formale per istanziare Greeter. Siccome formal è True, il risultato di chiamare greet() è un messaggio di benvenuto formale.</p>
<p>Anche se questo è un esempio "toy", mostra come i valori degli argomenti di default sono una feature potente in Python che possiamo usare per scrivere degli inizializzatori flessibili per le nostre classi. Questi inizializzatori ci permettono di istanziare le nostre classi usando diversi insiemi di argomenti a seconda delle nostre necessità.</p>
<p>Adesso che conosciamo le basi di <strong>init</strong>() e dello step di inizializzazione dell'oggetto, è il momento di cambiare marcia ed iniziare a vedere <strong>new</strong>() e lo step di creazione dell'oggetto.</p>
<h3 id="creazione-delloggetto-con-new">Creazione dell'oggetto con <strong>new</strong>()<a class="headerlink" href="#creazione-delloggetto-con-new" title="Permanent link">&para;</a></h3>
<p>Quando scriviamo delle classi Python, tipicamente non dobbiamo fornire la nostra implementazione del metodo speciale <strong>new</strong>(). La maggior parte delle volte, l'implementazione base dalla classe built-in object è sufficiente a creare un oggetto vuoto per la nostra classe attuale.</p>
<p>Tuttavia, ci sono alcuni casi d'uso interessanti per questo metodo. Ad esempio, possiamo usare <strong>new</strong>() per creare delle sottoclassi di tipi immutabili, come int, float, tuple e str. Nella seguente sezioni, vedremo come scrivere implementazioni custom di <strong>new</strong>() nelle nostre classi. Per farlo, codificheremo alcuni campioni che ci daranno un'idea di quando potremmo dover sovrascrivere questo metodo.</p>
<h3 id="fornire-dei-creatori-di-oggetti-custom">Fornire dei creatori di oggetti custom<a class="headerlink" href="#fornire-dei-creatori-di-oggetti-custom" title="Permanent link">&para;</a></h3>
<p>Tipicamente, scriveremo un'implementazione personalizzata di <strong>new</strong>() soltanto qunado dobbiamo controllare la crezione di una nuova istanza a basso livello. Adesso, se abbiamo bisogno di un'implementazione personalizzata di questo metodo, dobbiamo seguire alcuni step:</p>
<ul>
<li>creazione di una nuova istanza chiamando <code>super().__new__()</code> con gli argomenti adeguati</li>
<li>personalizzazione della nuova istanza in accordo ai nostri obiettivi specifici</li>
<li>restituzione della nuova istanza per continuare il processo di istanziamento</li>
</ul>
<p>Con questi tre step circoncisi, siamo in grado di personalizzare lo step di creazione dell'istanza nel processo di istanziamento Python. Ecco un esempio di come possiamo tradurre questi step in codice Python.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">SomeClass</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="c1"># Customize your instance here...</span>
        <span class="k">return</span> <span class="n">instance</span>
</code></pre></div>
<p>Questo esempio fornisce una specie di implementazione template di <strong>new</strong>(). Come sempre, <strong>new</strong>() prende la classe attuale come argomento tipicamente indicato come <code>cls</code>. Notiamo che stiamo usando *args e **kwargs per rendere il metodo più flessibile e manutenibile accettando un numero qualisasi di argomenti.</p>
<p>Notiamo che stiamo usando *args e **kwargs per rendere il metodo più flessibile e manutenibile accettando un numero arbitrario di argomenti. Dovremmo sempre definire <strong>new</strong>() con *args e **kwargs, a meno che non si abbiano buone ragioni per seguire un pattern differente.</p>
<p>Alla prima riga di <strong>new</strong>(), chiamiamo il metodo <strong>new</strong>() della classe padre per creare una nuova istanza ed allocarvi memoria. Per accedere al metodo <strong>new</strong>() della classe padre, usiamo la funzione super(). Questa catena di chiamate va fino al metodo <strong>new</strong>() di object, che è l'implementazione base di <strong>new</strong>() per tutte le classi Python.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>La classe object integrata è la classe base di default per tutte le classi Python.</p>
</div>
<p>Il passo successivo è personalizzare l'istanza appena creata. Possiamo fare tutto quello di cui abbiamo bisogno per personalizzare l'istanza. Infine, nel terzo step, dobbiamo restituire la nuova istanza per continuare il processo di istanziamento con lo step di inizializzazione.</p>
<p>E' importante notare che il metodo <strong>new</strong>() da solo accetta soltanto un arogmento singolo, ovvero la classe da istanziare. SE chiamiamo il metodo <strong>new</strong>() con più argomenti, avremo un TypeError:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">SomeClass</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="o">...</span>         <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="o">...</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="o">...</span>         <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
<span class="o">...</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">SomeClass</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
    <span class="o">...</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">()</span> <span class="n">takes</span> <span class="n">exactly</span> <span class="n">one</span> <span class="n">argument</span> <span class="p">(</span><span class="n">the</span> <span class="nb">type</span> <span class="n">to</span> <span class="n">instantiate</span><span class="p">)</span>
</code></pre></div>
<p>In questo esempio, abbiamo mandato *args e **kwargs come argomenti aggiuntivi nella chiamata a super().<strong>new</strong>(). Il sottostante metodo object.<strong>new</strong>() accetta soltanto la classe come argomento, per cui abbiamo un TypeError quando istanziamo la classe.</p>
<p>Ad ogni modo, <strong>new</strong>() accetta e passa argomenti extra ad <strong>init</strong>() se la nostra classe non sovrasrive <strong>new</strong>(), come nella seguente variazione di SomeClass:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">SomeClass</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="o">...</span>         <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
<span class="o">...</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">some_obj</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">some_obj</span>
<span class="o">&lt;</span><span class="n">__main__</span><span class="o">.</span><span class="n">SomeClass</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x7f67db8d0ac0</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">some_obj</span><span class="o">.</span><span class="n">value</span>
<span class="mi">42</span>
</code></pre></div>
<p>In questa implementazione di SomeClass, non sovrascriviamo <strong>new</strong>(). La creazione dell'oggetto è quindi delegata ad object.<strong>new</strong>(), che adessoa ccetta dei valori e li pasa a SomeClass.<strong>init</strong>() per finalizzare l'istanziamento. Adesso creiamo delle nuove, e completamente inizializzate, istanze di SomeClass, proprio come some_obj nell'esempio.</p>
<p>Adesso che sappiamo come scrivere la nostra implementazione di <strong>new</strong>(), siamo in grado di valutare alcuni esempi pratici che mostrano alcuni dei casi d'uso più comuni di questo metodo nella programmazione Python.</p>
<h3 id="subclassing-dei-tipi-built-in-immutabili">SUbclassing dei tipi built-in immutabili<a class="headerlink" href="#subclassing-dei-tipi-built-in-immutabili" title="Permanent link">&para;</a></h3>
<p>Per iniziare, vedriamo un caso d'uso di <strong>new</strong>() che consiste nel creare una sottoclasse di un tipo immutabile built-in. Ad esempio, diciamo di dover scrivere una classe Distanza come sottoclasse del tipo float di Python. La nostra classe avrà un ulteriore attributo per memorizzare l'unità usata per misurare la distanza.</p>
<p>Ecco un primo approccio a questo problema usando il metodo <strong>init</strong>():</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">Distance</span><span class="p">(</span><span class="nb">float</span><span class="p">):</span>
<span class="o">...</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
<span class="o">...</span>         <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="o">...</span>         <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>
<span class="o">...</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">in_miles</span> <span class="o">=</span> <span class="n">Distance</span><span class="p">(</span><span class="mf">42.0</span><span class="p">,</span> <span class="s2">&quot;Miles&quot;</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
    <span class="o">...</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="nb">float</span> <span class="n">expected</span> <span class="n">at</span> <span class="n">most</span> <span class="mi">1</span> <span class="n">argument</span><span class="p">,</span> <span class="n">got</span> <span class="mi">2</span>
</code></pre></div>
<p>Quando si fa una sottoclasse di un tipo immutabile built-in, abbiamo un errore. Parte del problema è che il valore è impostato durante la creazione, ed è troppo tardi per cambiarlo durante l'inizializzazione. Inoltre, float.<strong>new</strong>() viene chiamato "sotto al cofano", e non si occupa di argomenti extra allo stesso modo di object.<strong>new</strong>(). Questo è ciò che lancia l'errore nel nostro esempio precedente.</p>
<p>Per evitare questo problema, possiamo inizializzare l'oggetto al momento della creazione con <strong>new</strong>() invece di sovrascrivere <strong>init</strong>(). Ecco come possiamo farlo in pratica:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">Distance</span><span class="p">(</span><span class="nb">float</span><span class="p">):</span>
<span class="o">...</span>     <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
<span class="o">...</span>         <span class="n">instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="o">...</span>         <span class="n">instance</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span>
<span class="o">...</span>         <span class="k">return</span> <span class="n">instance</span>
<span class="o">...</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">in_miles</span> <span class="o">=</span> <span class="n">Distance</span><span class="p">(</span><span class="mf">42.0</span><span class="p">,</span> <span class="s2">&quot;Miles&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">in_miles</span>
<span class="mf">42.0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">in_miles</span><span class="o">.</span><span class="n">unit</span>
<span class="s1">&#39;Miles&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">in_miles</span> <span class="o">+</span> <span class="mf">42.0</span>
<span class="mf">84.0</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">dir</span><span class="p">(</span><span class="n">in_miles</span><span class="p">)</span>
<span class="p">[</span><span class="s1">&#39;__abs__&#39;</span><span class="p">,</span> <span class="s1">&#39;__add__&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">&#39;real&#39;</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">]</span>
</code></pre></div>
<p>In questo esempio, <strong>new</strong>() esegue i tre step che abbiamo visto nella sezione precedente. Per priam cosa, il metodo crea una nuova istanza della classe attuale, cls, chiamando super().<strong>new</strong>(). Questa volta, la chiamata va indietro a float.<strong>new</strong>(), che cera una nuova istanza inizializzando il suo valore come argomento. QUindi, il metodo customizza la nuova istanza aggiungendovi un attributo .unit. Infine, la nuova istanza viene restituita.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>La classe <code>Distance</code> nell'esempio precedente non fornisce un meccanismo di conversione di unità appropriato. Questo significa che qualcosa come <code>Distance(10, "km") + Distance(20, "miles")</code> non proverà a convertire le unità prima di aggiungere i valori.</p>
</div>
<p>Ecco fatto! Ora la classe Distance funziona come atteso, permettendoci di usare un attributo dell'istanza per memorizzare l'unità nella quale stiamo misurando la distanza. A differenza dei valori a virgola mobile memorizzati in una data istanza di <code>Distance</code>, l'attributo <code>.unit</code> è mutabile, per cui possiamo cambiare il suo valore qunado vogliamo. Infine, notiamo come una chiamata alla funzione <code>dir()</code> riveli che la nostra classe eredita feature e metodi da <code>float</code>.</p>
<h2 id="restituire-istanze-di-una-classe-differente">Restituire istanze di una classe differente<a class="headerlink" href="#restituire-istanze-di-una-classe-differente" title="Permanent link">&para;</a></h2>
<p>Restituire un oggetto di una classe differente è un requisito che può richiedere un'implementazione custom di <strong>new</strong>(). Tuttavia, dovremmo porre attenzione perché in questo caso Python salta interamente lo step di inizializzazione. Avremo quindi la responsabilità di prendere l'oggetto appena creto in uno stato valido prima di usarlo nel nostro codice.</p>
<p>Vediamo il seguente esempio, nel quale la classe Pet usa <strong>new</strong>() per restituire istanze di classe scelte casualmente.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># pets.py</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>

<span class="k">class</span> <span class="nc">Pet</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">choice</span><span class="p">([</span><span class="n">Dog</span><span class="p">,</span> <span class="n">Cat</span><span class="p">,</span> <span class="n">Python</span><span class="p">])</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;I&#39;m a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Never runs!&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Dog</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">communicate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;woof! woof!&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Cat</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">communicate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;meow! meow!&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Python</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">communicate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hiss! hiss!&quot;</span><span class="p">)</span>
</code></pre></div>
<p>In questo esempio, <code>Pet</code> fornisce un metodo <code>__new__()</code> che crea una nuova istanza selezionando casualmente una classe da una lista di classi esistenti.</p>
<p>Ecco come possiamo usare questa clase Pet come una factory di oggetti pet:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">pets</span> <span class="kn">import</span> <span class="n">Pet</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">pet</span> <span class="o">=</span> <span class="n">Pet</span><span class="p">()</span>
<span class="n">I</span><span class="s1">&#39;m a Dog!</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pet</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
<span class="n">woof</span><span class="err">!</span> <span class="n">woof</span><span class="err">!</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pet</span><span class="p">,</span> <span class="n">Pet</span><span class="p">)</span>
<span class="kc">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pet</span><span class="p">,</span> <span class="n">Dog</span><span class="p">)</span>
<span class="kc">True</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">another_pet</span> <span class="o">=</span> <span class="n">Pet</span><span class="p">()</span>
<span class="n">I</span><span class="s1">&#39;m a Python!</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">another_pet</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
<span class="n">hiss</span><span class="err">!</span> <span class="n">hiss</span><span class="err">!</span>
</code></pre></div>
<p>Ogni volta che istanziamo Pet, otteniamo u oggetto casuale da una diversa classe. Questo risultato è possibile perché non vi sono restrizioni sull'oggetto che <code>__new__()</code> può restituire. Usare <code>__new__()</code> in questo modo trasforma una classe in una factory flessibile e potente di oggetti, non limitate alle istanze di sé stessa.</p>
<p>Infine, notiamo come il metodo <code>__init__()</code> di Pet non viene mai eseguito. Questo è legato al fatto che <code>Pet.__new__()</code> restituisce sempre oggetti di una classe diversa da Pet stesso.</p>
<h2 id="permettere-solo-una-singola-istanza-nelle-nostre-classi">PErmettere solo una singola istanza nelle nostre classi<a class="headerlink" href="#permettere-solo-una-singola-istanza-nelle-nostre-classi" title="Permanent link">&para;</a></h2>
<p>Alle volte dobbiamo implementare una classe che ci permette la creazione di una singola istanza. QUesto tipo di classe è comunemente conosciuto come <em>singleton</em>. In questa situazione, il metodo <code>__new__()</code> ci viene in aiuto perché ci aiuta a restringere il numero di istanze che una data classe può avere.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>La maggior parte degli sviluppatori Python noterà che non dobbiamo implementare il design pattern singleton in Python a meno che non abbiamo già una classe funzionante a cui dobbiamo aggiungere le funzionalità del pattern. Il resto delle volte, possiamo usare una costante a livello di modulo per ottenre le stesse funzionalità singleton senza dover scrivere una classe relativamente complessa.</p>
</div>
<p>Ecco un esempio di come codificare una classe Singleton con un metodo <strong>new</strong>() che pemrmette la creazione di un'unica istanza alla volta. Per farlo, <code>__new__()</code> controlla l'esistenza di un'istanza precedentemente messa in cache di un attributo di classe:</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">Singleton</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="o">...</span>     <span class="n">_instance</span> <span class="o">=</span> <span class="kc">None</span>
<span class="o">...</span>     <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="o">...</span>         <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="o">...</span>             <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
<span class="o">...</span>         <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>
<span class="o">...</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">first</span> <span class="o">=</span> <span class="n">Singleton</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">second</span> <span class="o">=</span> <span class="n">Singleton</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">first</span> <span class="ow">is</span> <span class="n">second</span>
<span class="kc">True</span>
</code></pre></div>
<p>La classe Singleton in questo esempio ha un attributo di classe chiamato <code>_instance</code> di valore di default None che funziona come cache. Il metodo <code>__new__()</code> controlla che non esistano istanze precedenti testando il fatto che <code>cls._instance</code> sia None.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Nell'esempio precedente, la classe <code>Singleton</code> non fornisce un'implementazione di <code>__init__()</code>. Se dovessimo aver bisogno di una classe con un metodo <code>__init__()</code>, teniamo a mente che questo metodo sarà eseguito ogni volta che chiamiamo il costruttore <code>Singleton()</code>. Questo comportamento può causare degli strani effetti di inizializzazione e bug.</p>
</div>
<p>Se questa condizione è vera, allora il blocco di codice if crea una nuova istanza di Singleton e la memorizza in <code>cls._instance</code>. Infine, il metodo restituisce la nuova o esistente istanza al chiamante.</p>
<p>Quindi istanziamo Singleton due volte per provare a copstruire due diversi gogetti, <code>first</code> e <code>second</code>. Se compariamo l'identità di questi oggetti con l'operatore <code>is</code>, allora noteremo che entrambi gli oggetti sono in realtà lo stesso. I nomi <code>first</code> e <code>second</code> sono solo due reference allo stesso oggetto <code>Singleton</code>.</p>
<h2 id="emulazione-parziale-di-collectionsnamedtuple">Emulazione parziale di collections.namedtuple<a class="headerlink" href="#emulazione-parziale-di-collectionsnamedtuple" title="Permanent link">&para;</a></h2>
<p>Come esempio finale di come sfruttare <code>__new__()</code> nel nostro codice, possiamo spingere le nostre abilità Python e scrivere una funzione factory che emula parzialmente <code>collections.namedtuple()</code>. La funzione <code>namedtuple()</code> ci permette di creare delle sottoclassi di tuple con la feature aggiuntiva di avere campi nominali per accedere agli oggetti nella tupla.</p>
<p>Il codice sottostante implementa una funzione <code>named_tuple_factory()</code> che emula parzialmente questa funzionalità sovrascrivendo il metodo <code>__new__()</code> di una classe annidata chiamata <code>NamedTuple</code>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># named_tuple.py</span>

<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>

<span class="k">def</span> <span class="nf">named_tuple_factory</span><span class="p">(</span><span class="n">type_name</span><span class="p">,</span> <span class="o">*</span><span class="n">fields</span><span class="p">):</span>
    <span class="n">num_fields</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">NamedTuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">):</span>
        <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>

        <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_fields</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">type_name</span><span class="si">}</span><span class="s2"> expected exactly </span><span class="si">{</span><span class="n">num_fields</span><span class="si">}</span><span class="s2"> arguments,&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">type_name</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fields</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="nb">property</span><span class="p">(</span><span class="n">itemgetter</span><span class="p">(</span><span class="n">index</span><span class="p">)))</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="si">{</span><span class="n">type_name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">arg</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">NamedTuple</span>
</code></pre></div>
<p>Ecco come funziona questa factory riga per riga:</p>
<ul>
<li>alla riga 3 importiamo <code>itemgetter()</code> dal modulo <code>operator</code>. Questa funzione ci permette di restituire gli ingressi usando il loro indice nella sequenza che li contiene.</li>
<li>alla riga 5 definiamo <code>named_tuple_factory()</code>. Questa funzione prende un primo argomento chiamato <code>type_name</code>, che conterrà il nome della sottoclasse delle tuplce che vogliamo creare. L'argomento *fileds ci permette di parssare un numero indefinito di nomi di campi come stringhe.</li>
<li>la riga 6 definisce una variabile locale per contenere il numero di named fields forniti dall'utente.</li>
<li>la riga 8 definisce una classe annidata chiamata <code>NamedTuple</code>, che discende dalla classe integrata <code>tuple</code>.</li>
<li>la riga 9 fornisce un attributo di classe <code>__slots__</code>. Questo attributo definisce una tupla per contenere gli attributi dell'istanza. Questa tupla risparmia memoria agendo come una sostituta per il dizionario dell'istanza, <code>__dict__</code>, che altrimenti giocherebbe un ruolo simile.</li>
<li>la riga 11 implementa <code>__new__()</code> con <code>cls</code> come primo argomento. Questa implementazione prende anche l'argomento <code>*args</code> per accettare un numero indefinito di valori per il campo.</li>
<li>le righe dalla 12 alla 16 definiscono un'istruzione condizionale che controlla se il numero di oggetti da memorizzare nella tupla finale differisce dal numero di campi con un nome. Se questo è il caso, allora la condizione lancia un <code>TypeError</code> con un messaggio di errore.</li>
<li>la riga 17 imposta l'attributo <code>__name__</code> della classe attuale al valore fornito da <code>type_name</code>.</li>
<li>le righe 18 e 19 definsicon un ciclo for che cambia tutti i campi con un nome in una property che usa itemgetter() per restituire l'oggetto al dato indice. Il ciclo usa la funzione itnegrata <code>setattr()</code> per effettuare questa azione. Notiamo che la funzione integrata <code>enumerate()</code> fornisce il valore appropriato dell'indice.</li>
<li>la riga 20 restituisce una nuova istanza della classe attuale chiamando <code>super().__new__()</code>.</li>
<li>le righe 22 e 23 definiscono un metodo <code>__repr__()</code> per la nostra classe.</li>
<li>la riga 25 restituisce la nuova classe <code>NamedTuple</code>.</li>
</ul>
<p>Per provare la classe <code>named_tuple_factory()</code>, lanciamo una sessione interattiva nella cartella conenente il file named_tuple.py ed eseguiamo il seguente codice:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt;<span class="w"> </span>from<span class="w"> </span>named_tuple<span class="w"> </span>import<span class="w"> </span>named_tuple_factory

&gt;&gt;&gt;<span class="w"> </span><span class="nv">Point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>named_tuple_factory<span class="o">(</span><span class="s2">&quot;Point&quot;</span>,<span class="w"> </span><span class="s2">&quot;x&quot;</span>,<span class="w"> </span><span class="s2">&quot;y&quot;</span><span class="o">)</span>

&gt;&gt;&gt;<span class="w"> </span><span class="nv">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Point<span class="o">(</span><span class="m">21</span>,<span class="w"> </span><span class="m">42</span><span class="o">)</span>
&gt;&gt;&gt;<span class="w"> </span>point
Point<span class="o">(</span><span class="m">21</span>,<span class="w"> </span><span class="m">42</span><span class="o">)</span>
&gt;&gt;&gt;<span class="w"> </span>point.x
<span class="m">21</span>
&gt;&gt;&gt;<span class="w"> </span>point.y
<span class="m">42</span>
&gt;&gt;&gt;<span class="w"> </span>point<span class="o">[</span><span class="m">0</span><span class="o">]</span>
<span class="m">21</span>
&gt;&gt;&gt;<span class="w"> </span>point<span class="o">[</span><span class="m">1</span><span class="o">]</span>
<span class="m">42</span>

&gt;&gt;&gt;<span class="w"> </span>point.x<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">84</span>
Traceback<span class="w"> </span><span class="o">(</span>most<span class="w"> </span>recent<span class="w"> </span>call<span class="w"> </span>last<span class="o">)</span>:
<span class="w">    </span>...
AttributeError:<span class="w"> </span>can<span class="s1">&#39;t set attribute</span>

<span class="s1">&gt;&gt;&gt; dir(point)</span>
<span class="s1">[&#39;</span>__add__<span class="s1">&#39;, &#39;</span>__class__<span class="s1">&#39;, ..., &#39;</span>count<span class="s1">&#39;, &#39;</span>index<span class="s1">&#39;, &#39;</span>x<span class="s1">&#39;, &#39;</span>y<span class="err">&#39;</span><span class="o">]</span>
</code></pre></div>
<p>In questo snippet, abbiamo creato una nuova classe Point chiamando named<em>tuple</em>factory(). Il primo argomento in questa chiamata rappresenta il nome che l'oggetto della classe risultatne userà. Il secondo e terzo argomento sono i campi cn nome disponibili nella classe risultante.</p>
<p>Quindi creiamo un oggetto Point chiamando il costruttore di classe con valori appropriati epr i campi x ed y. Per accedere ai valori di ongi campo con nome, usiamo la dot notation. Possiamo anche usare gli indici per recuperare i valori dato che la nostra classe è una sottoclasse di tuple.</p>
<p>Dato che le tuple sono dei tipi di dati immutaibili, non possiamo assegnare nuovi valori alle coordinate del punto: se proviamo a farlo, avremo un AttributeError.</p>
<p>Infine, la chiamata a dir() con l'istanza del nostro punto come argomento rivela che l'oggetto eredtia tutti gli attributi e metodi che le tuple normali hanno in Python.</p>
<h2 id="conclusioni">conclusioni<a class="headerlink" href="#conclusioni" title="Permanent link">&para;</a></h2>
<p>Ora sappiamo come i costruttori di classe Python ci permettono di istanziare delle classi, per cui possiamo creare degli oggetti concreti e riutilizzabili nel nostro codice. In Python, i costruttori di classe lanciano internamente i processi di costruione, che prevedono la creazione ed inizializzazione dell'istanza. Questi passi sono condotti dai metodi <strong>new</strong>() ed <strong>init</strong>().</p>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; Angelo Cardellicchio - MIT License
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/anhelus" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:angelo.cardellicchio@poliba.it" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.7l167.6-182.9c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": [], "search": "../../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copiato", "clipboard.copy": "Copia", "search.result.more.one": "1 altro in questa pagina", "search.result.more.other": "# altri in questa pagina", "search.result.none": "Nessun documento trovato", "search.result.one": "1 documento trovato", "search.result.other": "# documenti trovati", "search.result.placeholder": "Scrivi per iniziare a cercare", "search.result.term.missing": "Non presente", "select.version": "Seleziona la versione"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.e1c3ead8.min.js"></script>
      
        <script src="../../../../../js/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>