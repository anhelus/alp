
<!doctype html>
<html lang="it" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.4">
    
    
      
        <title>Cosa è la code quality? - Informatica per l'Ingegneria (classe N)</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.50c56a3b.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-J2XESD8WDV"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-J2XESD8WDV",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-J2XESD8WDV",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cosa-e-la-code-quality" class="md-skip">
          Vai al contenuto
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Intestazione">
    <a href="../../.." title="Informatica per l&#39;Ingegneria (classe N)" class="md-header__button md-logo" aria-label="Informatica per l'Ingegneria (classe N)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Informatica per l'Ingegneria (classe N)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Cosa è la code quality?
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Cerca" placeholder="Cerca" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Cerca">
        
        <button type="reset" class="md-search__icon md-icon" title="Cancella" aria-label="Cancella" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inizializza la ricerca
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigazione" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Informatica per l&#39;Ingegneria (classe N)" class="md-nav__button md-logo" aria-label="Informatica per l'Ingegneria (classe N)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Informatica per l'Ingegneria (classe N)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home del corso
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tracce di esame svolte
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tracce di esame svolte
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../exams/17_01_2024/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Traccia del 17 gennaio 2024
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Indice">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Indice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#linter" class="md-nav__link">
    <span class="md-ellipsis">
      Linter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flake8" class="md-nav__link">
    <span class="md-ellipsis">
      Flake8
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-formatters" class="md-nav__link">
    <span class="md-ellipsis">
      Code formatters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code formatters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#isort" class="md-nav__link">
    <span class="md-ellipsis">
      isort
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#black" class="md-nav__link">
    <span class="md-ellipsis">
      Black
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-vulnerability-scanners" class="md-nav__link">
    <span class="md-ellipsis">
      Security Vulnerability Scanners
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Vulnerability Scanners">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bandit" class="md-nav__link">
    <span class="md-ellipsis">
      Bandit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safety" class="md-nav__link">
    <span class="md-ellipsis">
      Safety
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-commit-hooks" class="md-nav__link">
    <span class="md-ellipsis">
      pre-commit hooks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pre-commit hooks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ci-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      CI Pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#un-esempio-reale" class="md-nav__link">
    <span class="md-ellipsis">
      Un esempio reale
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusioni" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusioni
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="cosa-e-la-code-quality">Cosa è la code quality?<a class="headerlink" href="#cosa-e-la-code-quality" title="Permanent link">&para;</a></h1>
<p>Cosa intendiamo per <em>code quality</em>? Come facciamo a misurarla? Come miglioriamo la code quality ed il nostro codice Python?</p>
<p>In generale, la code quality si riferisce a quanto è funzionale e manutenibile il nostro codice. Il codice viene considerato di alta qualità quando:</p>
<ul>
<li>segue il suo scopo;</li>
<li>il suo comportamento può essere testato;</li>
<li>segue uno stile consistente;</li>
<li>è comprensibile;</li>
<li>non contiene vulnerabilità di sicurezza;</li>
<li>è ben documentato;</li>
<li>è semplice da manutenere.</li>
</ul>
<p>DAl momento che abbiamo già affrontato i primi due punti negli articoli precedenti, il focus di questo articolo è sui punti successivi. In particolare, vedremo come migliorare la qualità del nostro codice Python mediante l'uso di linter, code formatter e scanner per le vulnerabilità di sicurezza.</p>
<h2 id="linter">Linter<a class="headerlink" href="#linter" title="Permanent link">&para;</a></h2>
<p>I <em>linter</em> evidenziano gli errori di programmazione, stile, i bug, ed i costrutti "sospetti" mediante l'analisi del codice sorgente. I tool di linting sono semplici da impostare, forniscono dei buoni valori di defautl, e migliorano l'esperienza complessiva di sviluppo rimuovendo le frizioni tra gli sviluppatori che hanno diverse opinioni sullo stile.</p>
<p>Anche se il linting è una pratica comune, è ancora FROWNED da molti sviluppatori, dal momento che questi tendono ad essere molto spesso molto soggettivi.</p>
<p>Vediamo un rapido esempio.</p>
<div class="highlight"><span class="filename">Prima versione</span><pre><span></span><code><span class="n">numbers</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter a number: &#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">answer</span> <span class="o">!=</span> <span class="s1">&#39;quit&#39;</span><span class="p">:</span>
        <span class="n">numbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">break</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Numbers: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">numbers</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Versione due</span><pre><span></span><code><span class="n">numbers</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span> <span class="p">(</span><span class="n">answer</span> <span class="o">:=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter a number: &quot;</span><span class="p">))</span> <span class="o">!=</span> <span class="s2">&quot;quit&quot;</span><span class="p">:</span>
    <span class="n">numbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Numbers: </span><span class="si">{</span><span class="n">numbers</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><span class="filename">Versione tre</span><pre><span></span><code><span class="n">numbers</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter a number: &quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">answer</span> <span class="o">==</span> <span class="s2">&quot;quit&quot;</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">numbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Numbers: </span><span class="si">{</span><span class="n">numbers</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Quale tra le precedenti è migliore?</p>
<p>In termini di funzionalità, fanno praticamente la stessa cosa. Qual è quella che preferiamo con i nostri collaboratori?</p>
<p>Come sviluppatore, molto probabilmente lavirimo in team. E, in un team, è molto importante che tutti gli sviluppatori seguano gli stessi standard di codice. Altrimenti, risulta essere molto più complesso leggere il codice di qualcun altro. Il focus delle code reviews dovrebbe essere sui problemi ad alto livello, piuttosto che sui problemi sintattici di formattazione.</p>
<p>Ad esempio, se decidiamo di terminare ogni frase con un punto esclamativo, sarebbe molto difficile per un lettore inferire il tono. Se andiamo avanti e ignoraiamo gli standard comuni come le lettere maiuscole e le regole per lo spacing, le frasi saranno molto difficili da leggere. Sarà necessario molto più "cervello" per leggerle. Perderemmo lettori e collaboratori. Lo stesso vale per il codice. USiamo le linee guida per rendere più semplice ai nostri compagni sviluppatori (inclusi noi stessi) per trasferire gli intenti e collaborare ocn noi.</p>
<p>Siamo fortunati come sviluppatori Python ad avere la guida PEP-8 a nostra disposizione, che fornisce un insieme di convenzioni, linee guida e best practices per rendere il nostro codice più semplice da leggere e manutenere. Si focalizza sulle convenzioni dei nomi, commenti ai codici, e problemi al layout, come indentazioni e spazi. d esempio:</p>
<ul>
<li>una singola istruzione deve essere lunga al massimo 79 caratteri</li>
<li>usare lo spazio al posto dei tab</li>
<li>usare nomi di funzioni in minuscolo</li>
</ul>
<p>Per quello che riguarda i tool di linting, anche se ve ne sono molti in giro, per la maggior parte cercano gli errori nella logica del codice, o forzano gli standard di codice:</p>
<ul>
<li>code logic: questi controllano gli errori di programmazione, forzano gli standard, cercano i <em>code smells</em>, e controllano la complessità del codice. Pyflakes e McCabe sono i tool più popolari per il linting della code logic.</li>
<li>code style: questi controllano semplicemente gli standard del codcie sulla base del PEP-8. Un esempio di tool di questo tipo è pycodestyle.</li>
</ul>
<h2 id="flake8">Flake8<a class="headerlink" href="#flake8" title="Permanent link">&para;</a></h2>
<p>Flake8 è un wrapper di Pyflakes, pycodestyle e McCabe. Può essere installato come qualsiasi altro package PyPI:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>flake8
</code></pre></div>
<p>Diciamo che abbiamo il seguente codice slavato in un file chiamato <code>my_module.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">requests</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">get_error_message</span><span class="p">(</span><span class="n">error_type</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">error_type</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;red&#39;</span>
    <span class="k">elif</span> <span class="n">error_type</span> <span class="o">==</span> <span class="mi">403</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;orange&#39;</span>
    <span class="k">elif</span> <span class="n">error_type</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;yellow&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;blue&#39;</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://api.github.com/events&#39;</span><span class="p">)</span>
    <span class="n">STATUS</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">status_code</span>
    <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">STATUS</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">get_error_message</span><span class="p">(</span><span class="n">STATUS</span><span class="p">))</span>




<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>
<p>Per effettuare il linting di questo file, possiamo semplicemente eseguire il comando:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>flake8<span class="w"> </span>my_module.py
</code></pre></div>
<p>Questo dovrebbe produrre il seguente output:</p>
<div class="highlight"><pre><span></span><code>my_module.py:1:1:<span class="w"> </span>F403<span class="w"> </span><span class="s1">&#39;from requests import *&#39;</span><span class="w"> </span>used<span class="p">;</span><span class="w"> </span>unable<span class="w"> </span>to<span class="w"> </span>detect<span class="w"> </span>undefined<span class="w"> </span>names
my_module.py:3:1:<span class="w"> </span>E302<span class="w"> </span>expected<span class="w"> </span><span class="m">2</span><span class="w"> </span>blank<span class="w"> </span>lines,<span class="w"> </span>found<span class="w"> </span><span class="m">1</span>
my_module.py:15:11:<span class="w"> </span>F405<span class="w"> </span><span class="s1">&#39;get&#39;</span><span class="w"> </span>may<span class="w"> </span>be<span class="w"> </span>undefined,<span class="w"> </span>or<span class="w"> </span>defined<span class="w"> </span>from<span class="w"> </span>star<span class="w"> </span>imports:<span class="w"> </span>requests
my_module.py:25:1:<span class="w"> </span>E303<span class="w"> </span>too<span class="w"> </span>many<span class="w"> </span>blank<span class="w"> </span>lines<span class="w"> </span><span class="o">(</span><span class="m">4</span><span class="o">)</span>
</code></pre></div>
<p>Potremmo anche vedere un errore <code>my_module.py:26:11: W292 no newline at end of file</code> a seconda della configurazione della nostra IDE.</p>
<p>Per ogni violazione viene stampata a schermo una riga che contiene i seguenti dati:</p>
<ul>
<li>percorso del file (relativo alla cartella da dove è stato eseguito Flake8)</li>
<li>numero di riga</li>
<li>numero di colonna</li>
<li>identificativo della regola violata</li>
<li>descrizione della regola violata</li>
</ul>
<p>Le violazioni segnalate che iniziano con la F sono degli errori da Pyflakes, mentre quelle che iniziano con la E sono da pycodestyle.</p>
<p>Dopo aver corretto le violazioni, dovremmo avere:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">requests</span> <span class="kn">import</span> <span class="n">get</span>


<span class="k">def</span> <span class="nf">get_error_message</span><span class="p">(</span><span class="n">error_type</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">error_type</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;red&#39;</span>
    <span class="k">elif</span> <span class="n">error_type</span> <span class="o">==</span> <span class="mi">403</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;orange&#39;</span>
    <span class="k">elif</span> <span class="n">error_type</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;yellow&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;blue&#39;</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://api.github.com/events&#39;</span><span class="p">)</span>
    <span class="n">STATUS</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">status_code</span>
    <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">STATUS</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">get_error_message</span><span class="p">(</span><span class="n">STATUS</span><span class="p">))</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>
<p>Oltre a PyFlakes e pycodestile, possiamo usare Flake8 per controllare la CYCLOMATIC COMPLEXITY. Ad esempio, la funzione <code>get_error_message</code> ha una complessità pari a quattro, dal momento che ci sono quattro possibili branch (o percoris del codice):</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_error_message</span><span class="p">(</span><span class="n">error_type</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">error_type</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;red&#39;</span>
    <span class="k">elif</span> <span class="n">error_type</span> <span class="o">==</span> <span class="mi">403</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;orange&#39;</span>
    <span class="k">elif</span> <span class="n">error_type</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;yellow&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;blue&#39;</span>
</code></pre></div>
<p>Per forzare, ad esempio, una complessità massima di 3, eseguiamo la seguente istruzione:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>flake8<span class="w"> </span>--max-complexity<span class="w"> </span><span class="m">3</span><span class="w"> </span>my_module.py
</code></pre></div>
<p>Flake8 dovrebbe segnalare un errore del tipo:</p>
<div class="highlight"><pre><span></span><code>my_module.py:4:1:<span class="w"> </span>C901<span class="w"> </span><span class="s1">&#39;get_error_message&#39;</span><span class="w"> </span>is<span class="w"> </span>too<span class="w"> </span>complex<span class="w"> </span><span class="o">(</span><span class="m">4</span><span class="o">)</span>
</code></pre></div>
<p>Possiamo quindi effettuare un refactoring del tipo:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_error_message</span><span class="p">(</span><span class="n">error_type</span><span class="p">):</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">404</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span>
        <span class="mi">403</span><span class="p">:</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span>
        <span class="mi">401</span><span class="p">:</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">colors</span><span class="p">[</span><span class="n">error_type</span><span class="p">]</span> <span class="k">if</span> <span class="n">error_type</span> <span class="ow">in</span> <span class="n">colors</span> <span class="k">else</span> <span class="s1">&#39;blue&#39;</span>
</code></pre></div>
<p>Flake8 dovrebbe adesso dare esito positivo:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>flake8<span class="w"> </span>--max-complexity<span class="w"> </span><span class="m">3</span><span class="w"> </span>my_module.py
</code></pre></div>
<p>Possiamo aggiungere ulteriori controlli a Flake8 mediante il suo sistema di plugin. Ad esempio, per forzare le naming convention di PEP-8, isntalliamo pep8-naming:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pep8-naming
</code></pre></div>
<p>Eseguendo:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>flake8<span class="w"> </span>my_module.py
</code></pre></div>
<p>Dovremmo vedere:</p>
<div class="highlight"><pre><span></span><code>my_module.py:15:6:<span class="w"> </span>N806<span class="w"> </span>variable<span class="w"> </span><span class="s1">&#39;STATUS&#39;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">function</span><span class="w"> </span>should<span class="w"> </span>be<span class="w"> </span>lowercase
</code></pre></div>
<p>Per correggere:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://api.github.com/events&#39;</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">status_code</span>
    <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">get_error_message</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Diamo un'occhiata ad Awesome Flake8 Extension per una lista delle estensioni più popolari per Flake8.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Un altro tool popolare per il linting è Pylama che, come Flake8, mette insieme diversi linter.</p>
</div>
<h2 id="code-formatters">Code formatters<a class="headerlink" href="#code-formatters" title="Permanent link">&para;</a></h2>
<p>Mentre i linter si limitano a valutare problemi nel codice, i code formatter effettuano delle modifiche al codice sulla base di un insieme di standard.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Mantenere un codice ben formattato che segue una precisa guida per il suo stile lo rende più semplice da leggere, il che rende più semplice individuare bug ed aggiungere nuovi sviluppatori. Riduce inoltre i conflitti che possono emergere in fase di merge.</p>
</div>
<p>Di nuovo, dato che questo è un compito stupido sul quale gli sviluppatori hanno spesso pareri soggettivi (tab vs spazi, singole vs doppie virgolette), usare un tool di code formatting per riformattare automaticamente il codice è meglio.</p>
<h3 id="isort">isort<a class="headerlink" href="#isort" title="Permanent link">&para;</a></h3>
<p>isort viene usato per separare automaticamente gli import nei seguenti gruppi:</p>
<ul>
<li>standard library</li>
<li>librerie di terze parti</li>
<li>locali</li>
</ul>
<p>I diversi gruppi sono quindi ordinati in ordine alfabetico. Ad esempio:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># standard library</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># third-party</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">flask.cli</span> <span class="kn">import</span> <span class="n">AppGroup</span>

<span class="c1"># local</span>
<span class="kn">from</span> <span class="nn">your_module</span> <span class="kn">import</span> <span class="n">some_method</span>
</code></pre></div>
<p>Per installare il tool:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>isort
</code></pre></div>
<p>Volendo, è disponibile anche come plugin per Flake8, ed è chiamato <code>flake8-isort</code>.</p>
<p>Per eseguirlo su tutti i file nella cartella attuale e nelle sottocartelle:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>isort<span class="w"> </span>.
</code></pre></div>
<p>Invece, per eseguirlo su un singolo file:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>isort<span class="w"> </span>my_module.py
</code></pre></div>
<p>Prima avevamo:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">your_module</span> <span class="kn">import</span> <span class="n">some_method</span>
<span class="kn">from</span> <span class="nn">flask.cli</span> <span class="kn">import</span> <span class="n">AppGroup</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
</code></pre></div>
<p>Dopo otteniamo:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">flask.cli</span> <span class="kn">import</span> <span class="n">AppGroup</span>

<span class="kn">from</span> <span class="nn">your_module</span> <span class="kn">import</span> <span class="n">some_method</span>
</code></pre></div>
<p>Per controllare se i nostri import sono ordinati in maniera corretta, possiamo usare il flag --check-only:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>isort<span class="w"> </span>my_module.py<span class="w"> </span>--check-only

ERROR:<span class="w"> </span>my_module.py<span class="w"> </span>Imports<span class="w"> </span>are<span class="w"> </span>incorrectly<span class="w"> </span>sorted<span class="w"> </span>and/or<span class="w"> </span>formatted.
</code></pre></div>
<p>Per vedere i cambi che saranno applicati (senza applicarli) usiamo il flag --diff:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>isort<span class="w"> </span>my_module.py<span class="w"> </span>--diff

---<span class="w"> </span>my_module.py:before<span class="w">      </span><span class="m">2022</span>-02-28<span class="w"> </span><span class="m">22</span>:04:45.977272
+++<span class="w"> </span>my_module.py:after<span class="w">       </span><span class="m">2022</span>-02-28<span class="w"> </span><span class="m">22</span>:04:48.254686
@@<span class="w"> </span>-1,6<span class="w"> </span>+1,7<span class="w"> </span>@@
+import<span class="w"> </span>datetime
<span class="w"> </span>import<span class="w"> </span>os
-import<span class="w"> </span>datetime
+
+import<span class="w"> </span>requests
+from<span class="w"> </span>flask<span class="w"> </span>import<span class="w"> </span>Flask
+from<span class="w"> </span>flask.cli<span class="w"> </span>import<span class="w"> </span>AppGroup
<span class="w"> </span>from<span class="w"> </span>your_module<span class="w"> </span>import<span class="w"> </span>some_method
-from<span class="w"> </span>flask.cli<span class="w"> </span>import<span class="w"> </span>AppGroup
-import<span class="w"> </span>requests
-from<span class="w"> </span>flask<span class="w"> </span>import<span class="w"> </span>Flask
</code></pre></div>
<p>Dobbiamo usare l'opzione <code>--profile black</code> quando si usa isort con Black per evitare delle collisioni di code style:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>isort<span class="w"> </span>--profile<span class="w"> </span>black<span class="w"> </span>.
</code></pre></div>
<h2 id="black">Black<a class="headerlink" href="#black" title="Permanent link">&para;</a></h2>
<p>Black è un formatter che viene usato per riformattare il codice sulla base delle style guide di Black, che è molto simile a PEP-8.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>black
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Possiamo anche usare un plugin per Flake8, ovvero flake8-black.</p>
</div>
<p>Al solito, per riformattare i file in maniera ricorsiva all'interno della cartella attuale:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>black<span class="w"> </span>.
</code></pre></div>
<p>Al solito, può essere eseguito su un singolo file:</p>
<div class="highlight"><pre><span></span><code>$ python -m black my_module.py
</code></pre></div>
<p>Prima abbiamo:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pytest</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">&quot;module&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">authenticated_client</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
    <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/login&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="s2">&quot;dummy@email.ai&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;notreal&quot;</span><span class="p">),</span> <span class="n">follow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">client</span>
</code></pre></div>
<p>Dopo:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pytest</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">&quot;module&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">authenticated_client</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
    <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s2">&quot;/login&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="s2">&quot;dummy@email.ai&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;notreal&quot;</span><span class="p">),</span>
        <span class="n">follow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">client</span>
</code></pre></div>
<p>Se vogliamo semplicemente vedere se il nostro codice segue gli standard dello stile Black, possiamo usare il flag <code>--check</code>:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>black<span class="w"> </span>my_module.py<span class="w"> </span>--check

would<span class="w"> </span>reformat<span class="w"> </span>my_module.py
Oh<span class="w"> </span>no!<span class="w"> </span>💥<span class="w"> </span>💔<span class="w"> </span>💥
<span class="m">1</span><span class="w"> </span>file<span class="w"> </span>would<span class="w"> </span>be<span class="w"> </span>reformatted.
</code></pre></div>
<p>Il flag --diff invece ci mostra la differenza tra il codice attuale e quello che sarà quello riformattato:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>black<span class="w"> </span>my_module.py<span class="w"> </span>--diff

---<span class="w"> </span>my_module.py<span class="w">        </span><span class="m">2022</span>-02-28<span class="w"> </span><span class="m">22</span>:04:45.977272<span class="w"> </span>+0000
+++<span class="w"> </span>my_module.py<span class="w">        </span><span class="m">2022</span>-02-28<span class="w"> </span><span class="m">22</span>:05:15.124565<span class="w"> </span>+0000
@@<span class="w"> </span>-1,7<span class="w"> </span>+1,12<span class="w"> </span>@@
<span class="w"> </span>import<span class="w"> </span>pytest
+

<span class="w"> </span>@pytest.fixture<span class="o">(</span><span class="nv">scope</span><span class="o">=</span><span class="s2">&quot;module&quot;</span><span class="o">)</span>
<span class="w"> </span>def<span class="w"> </span>authenticated_client<span class="o">(</span>app<span class="o">)</span>:
<span class="w">     </span><span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>app.test_client<span class="o">()</span>
-<span class="w">    </span>client.post<span class="o">(</span><span class="s2">&quot;/login&quot;</span>,<span class="w"> </span><span class="nv">data</span><span class="o">=</span>dict<span class="o">(</span><span class="nv">email</span><span class="o">=</span><span class="s2">&quot;dummy@email.ai&quot;</span>,<span class="w"> </span><span class="nv">password</span><span class="o">=</span><span class="s2">&quot;notreal&quot;</span><span class="o">)</span>,<span class="w"> </span><span class="nv">follow_redirects</span><span class="o">=</span>True<span class="o">)</span>
-<span class="w">    </span><span class="k">return</span><span class="w"> </span>client
<span class="se">\ </span>No<span class="w"> </span>newline<span class="w"> </span>at<span class="w"> </span>end<span class="w"> </span>of<span class="w"> </span>file
+<span class="w">    </span>client.post<span class="o">(</span>
+<span class="w">        </span><span class="s2">&quot;/login&quot;</span>,
+<span class="w">        </span><span class="nv">data</span><span class="o">=</span>dict<span class="o">(</span><span class="nv">email</span><span class="o">=</span><span class="s2">&quot;dummy@email.ai&quot;</span>,<span class="w"> </span><span class="nv">password</span><span class="o">=</span><span class="s2">&quot;notreal&quot;</span><span class="o">)</span>,
+<span class="w">        </span><span class="nv">follow_redirects</span><span class="o">=</span>True,
+<span class="w">    </span><span class="o">)</span>
+<span class="w">    </span><span class="k">return</span><span class="w"> </span>client
would<span class="w"> </span>reformat<span class="w"> </span>my_module.py

All<span class="w"> </span><span class="k">done</span>!<span class="w"> </span>✨<span class="w"> </span>🍰<span class="w"> </span>✨
<span class="m">1</span><span class="w"> </span>file<span class="w"> </span>would<span class="w"> </span>be<span class="w"> </span>reformatted.
</code></pre></div>
<p>YAPF e autopep8 sono dei formatter simili a Black che meritano uno sguardo.</p>
<h2 id="security-vulnerability-scanners">Security Vulnerability Scanners<a class="headerlink" href="#security-vulnerability-scanners" title="Permanent link">&para;</a></h2>
<p>Le vulnerabilità di sicurezza sono probabilmente l'aspetto più importante della code quality, ma spesso sono ignorate. Il nostro codice è sicuro solo come la sua parte meno sicura. Per fortuna, c'è un gran numero di strumenti che ci aiutano ad individuare possibili vulnerabilità nel nostro codice. Vediamone un paio.</p>
<h3 id="bandit">Bandit<a class="headerlink" href="#bandit" title="Permanent link">&para;</a></h3>
<p>Bandit è uno strumento progettato per trovare dei problemi di sicurezza comuni nel codice Python, come stringhe con password in chiaro, codice untrusted che effettua la deserializzazione, usare pass in blocchi except, ed altro.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>bandit
</code></pre></div>
<p>Anche in questo caso abbiamo un plugin per Flake8, ovvero <code>flake8-bandit</code>. Eseguiamolo come segue:</p>
<p><div class="highlight"><pre><span></span><code>$<span class="w"> </span>bandit<span class="w"> </span>my_module.py
</code></pre></div><br />
Dato questo codice:</p>
<div class="highlight"><pre><span></span><code><span class="n">evaluate</span> <span class="o">=</span> <span class="s1">&#39;print(&quot;Hi!&quot;)&#39;</span>
<span class="nb">eval</span><span class="p">(</span><span class="n">evaluate</span><span class="p">)</span>


<span class="n">evaluate</span> <span class="o">=</span> <span class="s1">&#39;open(&quot;secret_file.txt&quot;).read()&#39;</span>
<span class="nb">eval</span><span class="p">(</span><span class="n">evaluate</span><span class="p">)</span>
</code></pre></div>
<p>Dovremmo vedere i seguenti avvisi:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;<span class="w"> </span>Issue:<span class="w"> </span><span class="o">[</span>B307:blacklist<span class="o">]</span><span class="w"> </span>Use<span class="w"> </span>of<span class="w"> </span>possibly<span class="w"> </span>insecure<span class="w"> </span><span class="k">function</span><span class="w"> </span>-<span class="w"> </span>consider<span class="w"> </span>using<span class="w"> </span>safer
<span class="w">    </span>ast.literal_eval.
<span class="w">   </span>Severity:<span class="w"> </span>Medium<span class="w">   </span>Confidence:<span class="w"> </span>High
<span class="w">   </span>Location:<span class="w"> </span>my_module.py:2
<span class="w">   </span>More<span class="w"> </span>Info:
<span class="w">    </span>https://bandit.readthedocs.io/en/latest/blacklists/blacklist_calls.html#b307-eval
<span class="m">1</span><span class="w">   </span><span class="nv">evaluate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;print(&quot;Hi!&quot;)&#39;</span>
<span class="m">2</span><span class="w">   </span>eval<span class="o">(</span>evaluate<span class="o">)</span>
<span class="m">3</span>

--------------------------------------------------
&gt;&gt;<span class="w"> </span>Issue:<span class="w"> </span><span class="o">[</span>B307:blacklist<span class="o">]</span><span class="w"> </span>Use<span class="w"> </span>of<span class="w"> </span>possibly<span class="w"> </span>insecure<span class="w"> </span><span class="k">function</span><span class="w"> </span>-<span class="w"> </span>consider<span class="w"> </span>using<span class="w"> </span>safer
<span class="w">    </span>ast.literal_eval.
<span class="w">   </span>Severity:<span class="w"> </span>Medium<span class="w">   </span>Confidence:<span class="w"> </span>High
<span class="w">   </span>Location:<span class="w"> </span>my_module.py:6
<span class="w">   </span>More<span class="w"> </span>Info:
<span class="w">    </span>https://bandit.readthedocs.io/en/latest/blacklists/blacklist_calls.html#b307-eval
<span class="m">5</span><span class="w">   </span><span class="nv">evaluate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;open(&quot;secret_file.txt&quot;).read()&#39;</span>
<span class="m">6</span><span class="w">   </span>eval<span class="o">(</span>evaluate<span class="o">)</span>

--------------------------------------------------
</code></pre></div>
<h3 id="safety">Safety<a class="headerlink" href="#safety" title="Permanent link">&para;</a></h3>
<p>Safety è un altro tool che è utile per mantenere il nostro codice libero da problemi di sicurezza. Viene usato per controllare le dipendenze installate per vulnerabilità di sicurezza conosciute rispetto a Safety DB, che è un database di vulnerability di sicurezza conosciute nei package Python.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>safety
</code></pre></div>
<p>Con l'ambiente virtuale attivato, possiamo eseguirlo come segue:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>safety<span class="w"> </span>check
</code></pre></div>
<p>Ecco un esempio di output con Flask v0.12.2:</p>
<div class="highlight"><pre><span></span><code>+<span class="o">==============================================================================</span>+
<span class="p">|</span><span class="w">                                                                              </span><span class="p">|</span>
<span class="p">|</span><span class="w">                               </span>/<span class="nv">$$$$$$</span><span class="w">            </span>/<span class="nv">$$</span><span class="w">                         </span><span class="p">|</span>
<span class="p">|</span><span class="w">                              </span>/<span class="nv">$$</span>__<span class="w">  </span><span class="nv">$$</span><span class="w">          </span><span class="p">|</span><span class="w"> </span><span class="nv">$$</span><span class="w">                         </span><span class="p">|</span>
<span class="p">|</span><span class="w">           </span>/<span class="nv">$$$$$$</span>$<span class="w">  </span>/<span class="nv">$$$$$$</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">$$</span><span class="w">  </span><span class="se">\_</span>_//<span class="nv">$$$$$$</span><span class="w">  </span>/<span class="nv">$$$$$$</span><span class="w">   </span>/<span class="nv">$$</span><span class="w">   </span>/<span class="nv">$$</span><span class="w">           </span><span class="p">|</span>
<span class="p">|</span><span class="w">          </span>/<span class="nv">$$</span>_____/<span class="w"> </span><span class="p">|</span>____<span class="w">  </span><span class="nv">$$</span><span class="p">|</span><span class="w"> </span><span class="nv">$$$$</span><span class="w">   </span>/<span class="nv">$$</span>__<span class="w">  </span><span class="nv">$$</span><span class="p">|</span>_<span class="w">  </span><span class="nv">$$</span>_/<span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="nv">$$</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="nv">$$</span><span class="w">           </span><span class="p">|</span>
<span class="p">|</span><span class="w">         </span><span class="p">|</span><span class="w">  </span><span class="nv">$$$$$$</span><span class="w">   </span>/<span class="nv">$$$$$$</span>$<span class="p">|</span><span class="w"> </span><span class="nv">$$</span>_/<span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="nv">$$$$$$$$</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="nv">$$</span><span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="nv">$$</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="nv">$$</span><span class="w">           </span><span class="p">|</span>
<span class="p">|</span><span class="w">          </span><span class="se">\_</span>___<span class="w">  </span><span class="nv">$$</span><span class="w"> </span>/<span class="nv">$$</span>__<span class="w">  </span><span class="nv">$$</span><span class="p">|</span><span class="w"> </span><span class="nv">$$</span><span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="nv">$$</span>_____/<span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="nv">$$</span><span class="w"> </span>/<span class="nv">$$</span><span class="p">|</span><span class="w"> </span><span class="nv">$$</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="nv">$$</span><span class="w">           </span><span class="p">|</span>
<span class="p">|</span><span class="w">          </span>/<span class="nv">$$$$$$</span>$/<span class="p">|</span><span class="w">  </span><span class="nv">$$$$$$</span>$<span class="p">|</span><span class="w"> </span><span class="nv">$$</span><span class="w">    </span><span class="p">|</span><span class="w">  </span><span class="nv">$$$$$$</span>$<span class="w">  </span><span class="p">|</span><span class="w">  </span><span class="nv">$$$$</span>/<span class="p">|</span><span class="w">  </span><span class="nv">$$$$$$</span>$<span class="w">           </span><span class="p">|</span>
<span class="p">|</span><span class="w">         </span><span class="p">|</span>_______/<span class="w">  </span><span class="se">\_</span>______/<span class="p">|</span>__/<span class="w">     </span><span class="se">\_</span>______/<span class="w">   </span><span class="se">\_</span>__/<span class="w">   </span><span class="se">\_</span>___<span class="w">  </span><span class="nv">$$</span><span class="w">           </span><span class="p">|</span>
<span class="p">|</span><span class="w">                                                          </span>/<span class="nv">$$</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="nv">$$</span><span class="w">           </span><span class="p">|</span>
<span class="p">|</span><span class="w">                                                         </span><span class="p">|</span><span class="w">  </span><span class="nv">$$$$$$</span>/<span class="w">           </span><span class="p">|</span>
<span class="p">|</span><span class="w">  </span>by<span class="w"> </span>pyup.io<span class="w">                                              </span><span class="se">\_</span>_____/<span class="w">            </span><span class="p">|</span>
<span class="p">|</span><span class="w">                                                                              </span><span class="p">|</span>
+<span class="o">==============================================================================</span>+
<span class="p">|</span><span class="w"> </span>REPORT<span class="w">                                                                       </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>checked<span class="w"> </span><span class="m">37</span><span class="w"> </span>packages,<span class="w"> </span>using<span class="w"> </span>default<span class="w"> </span>DB<span class="w">                                        </span><span class="p">|</span>
+<span class="o">============================</span>+<span class="o">===========</span>+<span class="o">==========================</span>+<span class="o">==========</span>+
<span class="p">|</span><span class="w"> </span>package<span class="w">                    </span><span class="p">|</span><span class="w"> </span>installed<span class="w"> </span><span class="p">|</span><span class="w"> </span>affected<span class="w">                 </span><span class="p">|</span><span class="w"> </span>ID<span class="w">       </span><span class="p">|</span>
+<span class="o">============================</span>+<span class="o">===========</span>+<span class="o">==========================</span>+<span class="o">==========</span>+
<span class="p">|</span><span class="w"> </span>flask<span class="w">                      </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.12.2<span class="w">    </span><span class="p">|</span><span class="w"> </span>&lt;<span class="m">0</span>.12.3<span class="w">                  </span><span class="p">|</span><span class="w"> </span><span class="m">36388</span><span class="w">    </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>flask<span class="w">                      </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.12.2<span class="w">    </span><span class="p">|</span><span class="w"> </span>&lt;<span class="m">1</span>.0<span class="w">                     </span><span class="p">|</span><span class="w"> </span><span class="m">38654</span><span class="w">    </span><span class="p">|</span>
+<span class="o">==============================================================================</span>+
</code></pre></div>
<p>Ora che conosciamo i tool, la prossima domanda è: quando usarli?</p>
<p>Tipicamente, dovremmo usarli:</p>
<ul>
<li>mentre si fa il coding (all'interno della nostra IDE)</li>
<li>a momento della commit</li>
<li>quando il codice viene controllato nel source control mediante una pipeline di CI</li>
<li>all'interno della nostra IDE</li>
</ul>
<p>E' meglio controllare dei problemi che possono avere un impatto negativo sulla qualità il prima possibile. Quindi, è fortemente raccomandato effettuare il linting e la formattazione del codice durante lo sviluppo. Molti degli IDE più popolari hanno dei linter e dei formatter integrati. Saremo in grado di trovare un plugin per il nostro editor per la maggior parte dei tool sopra menzionati. Alcuni plugin ci avvertono in tempo reale sulle violaizoni del code style e degli errori di programmazione.</p>
<h2 id="pre-commit-hooks">pre-commit hooks<a class="headerlink" href="#pre-commit-hooks" title="Permanent link">&para;</a></h2>
<p>Dal momento che, inevitabilmente, ci perderemo un warning alle volte mentre scriviamo il nostro codice, è una buona pratica controllare i problemi di qualità mentre facciamo la commit con dei pre-commit git hooks. Possiamo per prima cosa formattare il codice prima di effettuarne il linting. IN questo modo possiamo evitare di fear il commit di codice che non passerà i controlli di qualità nella nostra pipeline di CI.</p>
<p>Il framework di pre-commit è raccomandato per gestire i git hooks.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pre-commit
</code></pre></div>
<p>Una volta installato, aggiungiamo un file di configurazione pre-commit chiamato <code>.pre-commit-config.yaml</code> al nostro progetto. Per eseguire ad esempio Flake8, aggiungiamo la seguente configurazione:</p>
<div class="highlight"><pre><span></span><code><span class="nt">repos</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://gitlab.com/PyCQA/flake8</span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4.0.1</span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flake8</span>
</code></pre></div>
<p>Infine, impostiamo gli script git hook:</p>
<div class="highlight"><pre><span></span><code><span class="o">(</span>venv<span class="o">)</span>$<span class="w"> </span>pre-commit<span class="w"> </span>install
</code></pre></div>
<p>Ora, ogni volta che effettuiamo una commit Flake8 sarà eseguito prima della commit attuale. E se vi sono dei problemi, la commit sarà abbandonata.</p>
<h3 id="ci-pipeline">CI Pipeline<a class="headerlink" href="#ci-pipeline" title="Permanent link">&para;</a></h3>
<p>Anche se potremmo usare dei tool per la code qualità nel nostro editor e negli hook pre-commit, non possiamo sempre contare sul fatto che i nostri collaboratori facciano lo stesso. Di cosneguenza, dovremmo eseguire dei controlli per la code quality all'interno della nostra pipeline di CI. A questo punto, dovremmo eseguire dei linter e dei security vulnerability detector, assicurandoci che il codice segua un certo stile. Possiamo eseguire questi controlli in parallelo ai nostri test.</p>
<h3 id="un-esempio-reale">Un esempio reale<a class="headerlink" href="#un-esempio-reale" title="Permanent link">&para;</a></h3>
<p>Creiamo un semplice progetto di esempio per vedere come tutto questo funziona.</p>
<p>PEr prima cosa, creiamo una nuova cartella:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>mkdir<span class="w"> </span>flask_example
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>flask_example
</code></pre></div>
<p>Adesso inizializziamo il nostro progetto con pipenv:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pipenv<span class="w"> </span>--three
</code></pre></div>
<p>A questo punto, installiamo Flask, pytest, Flake8, Black, isort, Bandit, e Safety:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pipenv<span class="w"> </span>install<span class="w"> </span>flask
$<span class="w"> </span>pipenv<span class="w"> </span>install<span class="w"> </span>--dev<span class="w"> </span>pytest<span class="w"> </span>flake8<span class="w"> </span>black<span class="w"> </span>isort<span class="w"> </span>safety<span class="w"> </span>bandit
</code></pre></div>
<p>Creiamo un file che contenga i test chiamato <code>test_app.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">app</span>
<span class="kn">import</span> <span class="nn">pytest</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">client</span><span class="p">():</span>
    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;TESTING&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">client</span>


<span class="k">def</span> <span class="nf">test_home</span><span class="p">(</span><span class="n">client</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
</code></pre></div>
<p>Aggiungiamo adesso un file per l'app Flask chiamato <code>app.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;OK&#39;</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>
<p>Adesso siamo pronti ad aggiungere la configurazione pre-commit.</p>
<p>Per prima cosa, inizializziamo una nuova repository git:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>git<span class="w"> </span>init
</code></pre></div>
<p>A questo punto, installiamo la pre-commit, ed impostiamo gli script di git hook:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pipenv<span class="w"> </span>install<span class="w"> </span>--dev<span class="w"> </span>pre-commit
$<span class="w"> </span>pipenv<span class="w"> </span>run<span class="w"> </span>pre-commit<span class="w"> </span>install
</code></pre></div>
<p>Creiamo un file di configurazione chiamato <code>.pre-commit-config.yaml</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">repos</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://gitlab.com/PyCQA/flake8</span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4.0.1</span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flake8</span>
</code></pre></div>
<p>Prima di fare la commit, eseguiamo <code>isort</code> e Black:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pipenv<span class="w"> </span>run<span class="w"> </span>isort<span class="w"> </span>.<span class="w"> </span>--profile<span class="w"> </span>black
$<span class="w"> </span>pipenv<span class="w"> </span>run<span class="w"> </span>black<span class="w"> </span>.
</code></pre></div>
<p>Effettuiamo la commit per lanciare l'hook pre-commit:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>git<span class="w"> </span>add<span class="w"> </span>.
$<span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;Initial commit&#39;</span>
</code></pre></div>
<p>Infine, configuriamo una CI pipeline mediante GitHub Actions. Per farlo, creiamo la seguente struttura di file e cartelle:</p>
<div class="highlight"><pre><span></span><code>.github
└── workflows
    └── main.yaml
</code></pre></div>
<p>Nel file <code>.github/workflows/main.yaml</code> inseriamo il seguente codice:</p>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CI</span>
<span class="nt">on</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">push</span><span class="p p-Indicator">]</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">test</span><span class="p">:</span>
<span class="w">    </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">fail-fast</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">      </span><span class="nt">matrix</span><span class="p">:</span>
<span class="w">        </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">3.10.2</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">poetry-version</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1.1.13</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">os</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ubuntu-latest</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.os }}</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v2</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.python-version }}</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run image</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">abatilo/actions-poetry@v2.0.0</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">poetry-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.poetry-version }}</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">poetry install</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run tests</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">poetry run pytest</span>
<span class="w">  </span><span class="nt">code-quality</span><span class="p">:</span>
<span class="w">    </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">fail-fast</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">      </span><span class="nt">matrix</span><span class="p">:</span>
<span class="w">        </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">3.10.2</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">poetry-version</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1.1.13</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">os</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ubuntu-latest</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.os }}</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v2</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.python-version }}</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run image</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">abatilo/actions-poetry@v2.0.0</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">poetry-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.poetry-version }}</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">poetry install</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run black</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">poetry run black . --check</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run isort</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">poetry run isort . --check-only --profile black</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run flake8</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">poetry run flake8 .</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run bandit</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">poetry run bandit .</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run saftey</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">poetry run safety check</span>
</code></pre></div>
<p>Questa configurazione:</p>
<ul>
<li>viene eseguita ad ogni push (<code>on: [push]</code>)</li>
<li>viene eseguita sull'ultima versione di Ubuntu (<code>ubuntu-latest</code>)</li>
<li>usa Python 3.10.2 (<code>python-version: [3.10.2], python-version: ${{ matrix.python-version }}</code>)</li>
<li>usa Pipenv nella versione X.X.X (<code>poetry-version: [1.1.13], poetry-version: ${{ matrix.poetry-version }}</code>)</li>
</ul>
<p>Vengono definiti due job: il test e la verifica della qualità del codice. Come suggerisce il nome, i test sono eseguiti nel job <code>test</code>, mentre i controlli per la code quality sono eseguiti nel job <code>code-quality</code>.</p>
<p>Aggiungiamo la configurazione CI a git ed effettuiamo la commit:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>git<span class="w"> </span>add<span class="w"> </span>.github/workflows/main.yaml
$<span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;Add CI config&#39;</span>
</code></pre></div>
<p>Creiamo infine una nuova repository su GitHub, ed effettuiamo il push del nostro progetto al remote appena creato. Ad esempio:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>origin<span class="w"> </span>git@github.com:jangia/flask_example.git
$<span class="w"> </span>git<span class="w"> </span>branch<span class="w"> </span>-M<span class="w"> </span>main
$<span class="w"> </span>git<span class="w"> </span>push<span class="w"> </span>-u<span class="w"> </span>origin<span class="w"> </span>main
</code></pre></div>
<p>Dovremmo vedere il nostro workflow eseguito sul tab Actions sulla nostra repository GitHub.</p>
<h2 id="conclusioni">Conclusioni<a class="headerlink" href="#conclusioni" title="Permanent link">&para;</a></h2>
<p>Quello della qualità del codice è uno dei topic più soggettivi nello sviluppo software. Lo stile del codice, in particolare, è un topic sensibile tra gli sviluppatori, dato che spendiamo molto del tempo di sviluppo leggendo codice. E' molto più semplice leggere e comprendere quando il codice ha uno stile ocnsistente che aderisce agli standard PEP-8. Dal momento che questo è un procedimento noioso, dovrebbe essere gestito da un computer mediante dei code formatter come Black ed isort. In modo simile, Flake8, Bandit e Safety ci aiutano ad assicurare che il codice sia sicuro e privo di errori.</p>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; Angelo Cardellicchio - MIT License
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/anhelus" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:angelo.cardellicchio@poliba.it" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.7l167.6-182.9c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.c011b7c0.min.js", "translations": {"clipboard.copied": "Copiato", "clipboard.copy": "Copia", "search.result.more.one": "1 altro in questa pagina", "search.result.more.other": "# altri in questa pagina", "search.result.none": "Nessun documento trovato", "search.result.one": "1 documento trovato", "search.result.other": "# documenti trovati", "search.result.placeholder": "Scrivi per iniziare a cercare", "search.result.term.missing": "Non presente", "select.version": "Seleziona la versione"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.7389ff0e.min.js"></script>
      
        <script src="../../../js/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>